# Test macros for delay functionality in Klipper

[gcode_macro TEST_G4_SECONDS]
description: Test G4 with seconds parameter
gcode:
    M118 TEST_G4_SECONDS: Starting at {printer.system_stats.print_time}
    M117 G4 S test starting...
    G4 S5
    M118 TEST_G4_SECONDS: After 5 seconds at {printer.system_stats.print_time}
    M117 G4 S test complete

[gcode_macro TEST_G4_MILLISECONDS]
description: Test G4 with milliseconds parameter
gcode:
    M118 TEST_G4_MILLISECONDS: Starting at {printer.system_stats.print_time}
    M117 G4 P test starting...
    G4 P5000
    M118 TEST_G4_MILLISECONDS: After 5000ms at {printer.system_stats.print_time}
    M117 G4 P test complete

[gcode_macro TEST_DELAY_BUILTIN]
description: Test Klipper built-in delay
gcode:
    M118 TEST_DELAY_BUILTIN: Starting at {printer.system_stats.print_time}
    M117 Built-in delay test starting...
    {% if printer.configfile.settings.delayed_gcode %}
        # Use delayed_gcode approach
        M118 Using delayed_gcode method
        UPDATE_DELAYED_GCODE ID=test_delay DURATION=5
    {% else %}
        M118 delayed_gcode not available, trying alternative
        # Try direct delay
        G4 P5000
    {% endif %}
    M118 TEST_DELAY_BUILTIN: After delay at {printer.system_stats.print_time}
    M117 Built-in delay test complete

[gcode_macro TEST_LOOP_DELAY]
description: Test multiple small delays in a loop
gcode:
    M118 TEST_LOOP_DELAY: Starting at {printer.system_stats.print_time}
    M117 Loop delay test starting...
    {% for i in range(5) %}
        G4 P1000
        M118 Loop iteration {i+1} at {printer.system_stats.print_time}
    {% endfor %}
    M118 TEST_LOOP_DELAY: Complete at {printer.system_stats.print_time}
    M117 Loop delay test complete

[delayed_gcode test_delay]
gcode:
    M118 DELAYED_GCODE: Triggered at {printer.system_stats.print_time}
    M117 Delayed gcode executed

[gcode_macro RUN_ALL_DELAY_TESTS]
description: Run all delay tests in sequence
gcode:
    M118 === STARTING ALL DELAY TESTS ===
    M118 Current time: {printer.system_stats.print_time}
    
    M118 --- Test 1: G4 S (seconds) ---
    TEST_G4_SECONDS
    
    M118 --- Test 2: G4 P (milliseconds) ---
    TEST_G4_MILLISECONDS
    
    M118 --- Test 3: Built-in delay ---
    TEST_DELAY_BUILTIN
    
    M118 --- Test 4: Loop delay ---
    TEST_LOOP_DELAY
    
    M118 === ALL TESTS COMPLETE ===
    M118 Final time: {printer.system_stats.print_time}